Let $\pi \in S_n$, and let $a_j = \pi(j)$. Some representations of $\pi$: "2-line representation":
$1, 2, 3, ... n$
$a_1, a_2, a_3, ... a_n$. (Written as an actual array, properly spaced (rather than commas) with big parentheses on both sides.) 1-line representation: $(a_1, a_2, ... a_n)$ 
## Inversions in Permutations
Let $(\pi_1, \pi_2, ... \pi_n) \in S_n$; if $\pi_i > \pi_j$ for some $i < j$, then $(\pi_i, \pi_j)$ is called an inversion. $E(\pi)$ is the set of all inversion pairs of $\pi$, and $\pi_I$ is the "inversion table" of $\pi$: $\pi_I = b_1b_2...b_n$ where $b_j$ is the number of times that $j$ is the second component of an inversion pair, i.e. the number of elements $i < j$ such that $\pi_i > \pi_j$. E.g. $b_n$ = 0 always, since there's no element larger than n which could show up after n in the permutation; n would show up in the second element of a pair if it came after a number it usually comes before, but n doesn't come before anything in $[n]$. Finally, let the "inversion number" $|\pi_I| = \sum_{k=1}^nb_k$. Ex: in the permutation (3, 1, 2) we have the inversions (3, 1) and (3, 2) and that's it. Inversion table is 1, 1, 0; inversion number is 2. Among permutations of n, the one with the largest inversion number will be (n, n-1, ... 1), which has inversion table n-1, n-2, ... 0 and inversion number 0 + 1 + ... + n-2 + n-1 = (n-1)(n)/2. 

Another ex: let $\pi = (4, 6, 3, 5, 1, 2)$. Its inversion pairs are (4, 1), (4, 2), (4, 3), (6, 3), (6, 5), (6, 1), (6, 2), (3, 1), (3, 2), (5, 1), (5, 2); inversion table is 4, 4, 2, 0, 1, 0
### Reconstructing a Permutation from its Inversion Table
There is a bijection between inversion tables and permutations of n. E.g. take the table above. Start by writing down 6. Then since $b_5 = 1$, 5 is out of order:
6 5
$b_4$ is 0, so 4 is in the right place relative to 5 and 6:
4 6 5
$b_3$ is 2, so 3 appears before 2 of the numbers already written:
4 6 3 5
and then add 2 and 1 in the same way to get 4,6,3,5,1,2. 

Inversion number of a permutation is the same as its inverse. N.B. write down Rothe diagram proof from handout. 
### Counting Permutations with k Inversions
Let $I_n(k)$ count the number of permutations in $S_n$ with k inversions. For fixed n you can have at most (n)(n+1)/2 inversions (corresponding to the number of inversions in a "backwards" permuation like (4, 3, 2, 1)), and there's only 1 permutation with that many inversions. So $I_n(\binom{n}{2}) = 1$. Also, $I_n(1) = n - 1$: a permutation with 1 inversion corresponds to swapping 2 adjacent numbers and leaving everything else the same, and there are n -1 such permutations: swapping 1 and 2, swapping 2 and 3, ... and swapping n-1 and n. Also we have a symmetry property: $I_n(k) = I_n(\binom{n}{2} - k)$. This can be proven bijectively involving a map which sends inversion tables of a permutation with k cycles to their complements. (Proof later.) You can generate the next row (i.e. $I_n(k)$ for fixed n, all relevant k) using the row for $I_{n-1}$. In particular $I_n(k) = \sum_{j=0}^{n-1}I_{n-1}(k-j)$, using the definition that $I_n(k) = 0$ when $k < 0$. (Proof later.) 

A property of the inversion set $E(\pi)$ is that it is transitive, i.e. whenever $(a, b)$ and $(b, c)$ are in it, so is $(a, c)$. Furthermore, so is its complement (relative to the set of all ordered pairs (a, b) with $1 \leq b < a \leq n$). 

Let $J_n(x) = \sum_{k \geq 0}I_n(k)x^k$, i.e. let it be the generating function of $I_n(k)$ for fixed n. So e.g. $J_3(x) = 1 + 2x + 2x^2 + x^3$. Note that $J_3(x) = (1+x)(1 + x + x^2) = J_2(x)(1+x+x^2)$. In general $J_n(x) = J_{n-1}(x)\sum_{i=0}^{n-1}x^i$. Proof: 

## Cycles in Permutations
Cycle in a permutation: sequence $j, \pi(j), \pi^2(j), ... \pi^k(j)$ such that $\pi^k(j) = j$. Ex: permutation (1 3 4 6 7 8 2 5) has cycles 1 -> 1 and 2 -> 3 -> 4 -> 6 -> 8 -> 5 ->7 -> 2. We can thus write the permutation in "cycle notation" as (1)(2346857). Generalization is obvious: write down the cycles of 1, 2, ... n skipping elements if they've already been written in a cycle. 

Only 1 permutation on n elements with n cycles (the identity permutation); (n-1)! permutations having exactly one cycle (proof: start the cycle with 1, pick one of the n-1 remaining elements to go next in the cycle, then one of the remaining n-2... and so on until all of the elements have shown up once and only once in the cycle; (n-1)! ways to do this). Alternatively, you can create a bijection between the set of all single-cycle permutations on n elements and $S_{n-1}$: write each one-cycle permutation in canonical form (i.e. as a single cycle starting with 1), and chop off the 1 to get a permutation on $\{2, 3, ... n\}$ in one-line notation. This is a perfectly well-defined function and has an inverse given by adjoining a 1 to the start of a permutation on $\{2, 3, ... n\}$ written in one-line notation and considering the result as a single-cycle permutation on n elements. (Strictly speaking this only bijects between the n-permutations with 1 cycle and the set of all permutations on $\{2, 3, ... n\}$, but there's an obvious bijection between that and the permutations on $\{1, ... n-1\}$.)
### Counting Permutations With Given Cycle Lengths
Theorem:  let $c_1, ... c_n$ be nonnegative integers with $\sum_{j=1}^n jc_j = n$ -- here, $c_j$ represents the number of cycles of length j in a given permutation. Then the number of n-permutations with $c_j$ cycles of length $j$ is given by $\frac{n!}{c_1!c_2!...c_n!*1^{c_1}2^{c_2}...n^{c_n}}$. Example: how many n-permutations have only one cycle (necessarily a cycle of length n)? Then we have $c_n = 1$, all other $c_i$ are 0, the sum in the statement of the theorem is $1 * n = n$, and we see that the number of permutations with one cycle is $\frac{n!}{1!n^1} = \frac{n!}{n} = (n-1)!$ --exactly as derived earlier. 

Proof of the above: let $\pi \in S_n$, and let $C \subseteq \mathbb{N}$ be the set of all n-permutations with the given cycle structure. We will find a map $f$ (which will depend on what values of $c_1, ... c_n$ we're considering) from $S_n$ to $C$ in order to count the elements of $C$. Write $\pi$ in 1-line notation $\pi_1\pi_2...\pi_n$. Then draw in parentheses according to the $c_j$s to get a permutation in cycle notation - e.g. let $\pi$ = 4231, and let $c_1 = 2, c_2 = 1, c_3 = 0, c_4 = 0$. Then the map sends $\pi$ to $(4)(2)(31)$. 

Now consider the permutations in 1-line notation that get mapped to the same cycle-notation permutation. E.g. for 4-permutations with $c_1 = 2, c_2 = 1$, the permutations $1234$,  $1243$, and $2134$ will get mapped to $(1)(2)(34)$, $(1)(2)(43)$, and $(2)(1)(34)$, but those are really the same permutation. Now we ask: given some $\pi$, how many other permutations get mapped to a different cycle-notation representation of the same permutation to which $\pi$ gets mapped? Given a permutation in cycle notation, you can change how it's written without changing the underlying permutation by permuting cycles of the same length among themselves-- there are $c_1!$ ways to permute the 1-cycles, $c_2!$ ways to permute the 2-cycles, and so on, with $c_1!...c_n!$ total ways to permute the cycles among themselves (by the product rule). (Note that we only consider permuting the cycles with other cycles of the same length; doing otherwise could produce cycle-notation permutations that our map $f$, which always puts cycles of smaller lengths first, would never produce. E.g. we don't consider permuting $(1)(2)(34)$ to $(1)(34)(2)$ since $f$ wouldn't produce the latter--it would send $1342$ to $(1)(3)(42)$.) We can also change the representation without changing the permutation by "rotating" the elements of an individual cycle within that cycle-- e.g. changing $(1)(2)(34)$ to $(1)(2)(43)$. A single k-cycle has k such rotations, so if there are $c_k$ k-cycles then there are $k^{c_k}$ ways to rotate the k-cycles, and across all cycle sizes, this works out to $1^{c_1}2^{c_2}...n^{c_n}$ rotations. Finally, considering all the valid ways to permute and rotate the permutation gets $c_1!...c_n!1^{c_1}...n^{c_n}$. 

Thus for each permutation c $\in$  $C$, there are $c_1!...c_n!1^{c_1}...n^{c_n}$ permutations in $S_n$ that get mapped to c; thus $|S_n| = (c_1!...c_n!1^{c_1}...n^{c_n})|C|$, so $|C| = \frac{|S_n|}{c_1!...c_n!1^{c_1}...n^{c_n}} = \frac{n!}{c_1!...c_n!1^{c_1}...n^{c_n}}$.  
### Stirling Numbers of the First Kind
Definition: let $n, k \geq 0$, and let (column with square brackets) $[n], k$ denote the set of all n-permutations with exactly k cycles; $c(n, k)$ be the number of such permutations. $c(0, 0)$ is defined to be 1. These are also called the "signless Stirling numbers of the first kind". The actual Stirling numbers of the first kind are defined by $s(n, k) = (-1)^{n-k}c(n, k)$. E.g. $c(3, 2) = 3$ (corresponding to $(12)(3), (13)(2), (1)(23)$, and $s(3, 2) = (-1)^{3 - 2} * 3 = -3$. 

For $n \geq 1$, $\sum_k c(n, k) = n!$, as both sides just count the total number of permutations of $[n]$, with the LHS dividing into cases based on the number of cycles. We know from arguments above that $S(n, 1) = (n-1)!$ for all n, and $S(n, n) = 1$ (only 1 n-permutation with n cycles, namely the identity permutation). 
#### Recurrence for Signless Stirling Numbers
Recurrence for the signless Stirling numbers: $c(n, k) = c(n-1, k-1) + (n-1)c(n-1, k)$. Proof: one can create a permutation on n elements with k cycles by taking a permutation on n-1 elements with k-1 cycles and adding n as a singleton cycle (c(n-1, k-1) such permutations), or you can take a permutation on n-1 elements with k cycles and insert n somewhere, picking one of the existing n-1 elements for n to go after (c(n-1, k) such permutations, and for each such permutation you can generate n-1 distinct permutations by choosing where n goes; thus (n-1)c(n-1, k) total permutations can be generated this way). (N.B. nothing is lost by failing to consider inserting n at the start of a cycle, since that's the same as inserting it after the "last" element of the cycle.) Summing the cases gets the statement above. 

### Generating Function For Cycle Numbers
Let $g_n(x) = \sum_k c(n, k)x^k$. E.g. $g_0(x) = 1$, by definition (where c(0, 0) = 1). For n > 0, using the recurrence, $g_n(x) = \sum_k c(n-1, k-1)x^k + (n-1)\sum_kc(n-1, k)x^k$. Factoring an x out of the left sum, we get $x\sum_kc(n-1, k-1)x^{k-1} + (n-1)\sum_kc(n-1, k)x^k$ which is $xg_{n-1}(x) + (n-1)g_{n-1}(x) = g_{n-1}(x)(x+n-1)$. Thus $g_n(x) = g_{n-1}(x)(x+n-1)$. So for example, $g_1(x) = g_0(x) (x+1-1) = g_0(x) * x = x, g_2(x) = g_1(x)(x+2-1) = x(x+1), g_3(x) = x(x+1)(x+2)$, and so on: in general $g_n(x) = x(x+1)...(x+n-1) = x^{\bar{n}}$, i.e. x "rising factorial" n. 

### Derangements
A permutation with no fixed points is called a derangement. The number of derangements of $n$ elements, $D_n$, turns out to have a more-or-less explicit formula: $$D_n = n!\sum_{k=0}^n \frac{(-1)^k}{k!}$$ First, a few identities satisfied by $D_n$.
#### Derangement identities
First, a recurrence: $D_n = (n-1)D_{n-1} + (n-1)D_{n-2}$. Proof: either $n$ is in a 2-cycle or a cycle of length more than 2. In the first case, pick one element from $[n-1]$ and derange the remaining $n-2$; this gives $(n-1)D_{n-2}$ derangements. In the second, pick a derangement of $n-1$ elements and insert $n$ into one of the existing cycles. That is, once you've picked a derangement $d$, pick an element $i \in [n-1]$, say with $d(i) = j$, then create a new permutation $d'$ which is identical to $d$ except that $d'(i) = n, d'(n) = j$. There are $D_{n-1}$ ways to pick the derangement and $n-1$ ways to pick $i$, for $(n-1)D_{n-1}$ ways. Putting these cases together gives the identity.

Next, an identity which will be used in the derivation of the explicit formula: $n! = \sum_{k=0}^n \binom{n}{k}D_{n-k}$. Proof: break all the permutations of $[n]$ into cases based on the number of fixed points; for a given $k$, there are $\binom{n}{k}$ ways to choose $k$ elements to be fixed points, and $D_{n-k}$ ways to permute the rest in a way that doesn't create any additional fixed points.

#### Explicit formula: 3 proofs
The identity above can be changed by a simple reindexing into $n! = \sum_{k=0}^n \binom{n}{k}D_k$, which can be dealt with using binomial inversion to give $D_n = \sum_{k=0}^n \binom{n}{k} k! (-1)^{n-k} = \sum_{k=0}^n \frac{n!}{(n-k)!k!}k!(-1)^{n-k} = n!\sum_{k=0}^n \frac{(-1)^{n-k}}{(n-k)!} = n!\sum_{k=0}^n \frac{(-1)^k}{k!}$, as desired. 

Alternatively, the manipulations with exponential generating functions that underly the use of binomial inversion here can be made more explicit. Letting $D(x)$ be the exponential generating function of $D_n$, the identity above implies that $\sum_n n!\frac{x^n}{n!} = e^xD(x)$, or $e^xD(x) = \frac{1}{1-x}$. This means $D(x) = \frac{e^{-x}}{1-x}$. Now treating both sides as ordinary generating functions and comparing coefficients, we get $D_n/n! = \sum_{k=0}^n \frac{(-1)^k}{k!}$ or $D_n = n! \sum_{k=0}^n \frac{(-1)^k}{k!}$ 

Finally, the formula can be proven in a completely different way with inclusion-exclusion. 

## Sign/Parity of a Permutation
For a permutation $\pi$, define sgn$(\pi)$ = $(-1)^{I(\pi)}$, i.e. 1 if the number of inversions is even, -1 if it's odd. Note that sgn is a homomorphism from $S_n$ to $\{-1, 1\}$ with multiplication on the second set defined as expected. Note also that the sign of a transposition (permutation containing a only single 2-cycle and a bunch of 1-cycles) is always -1. N.B. find or work out a good proof of those facts; use to prove results about the sign of a permutation and determinants of permutation matrices. See 3-22 exercises.

A "simple" transposition, i.e. a permutation that only swaps k and k+1, will have an inversion number of 1. A more general transposition $(ij)$ with $i < j$ will (proof? even true?) have $2(j - i - 1)  + 1$ inversions.

A permutation consisting of a single cycle of even/odd length will have odd/even parity. 

## Permutation Matrices
A function on an n-dimensional vector space that just permutes some basis vectors among themselves is a linear map. It can be represented with a matrix like $\begin{pmatrix} 1 & 0 & 0 \\ 0 & 0 & 1 \\ 0 & 1 & 0 \end{pmatrix}$ , which is the map that takes basis vector $e_1$ to itself, $e_2$ to $e_3$, and $e_3$ to $e_2$; in general, matrix representations of these maps will have a single 1 in each row and column. There's a natural isomorphism between these nxn permutation matrices and permutations in $S_n$. 

### Determinants of Permutation Matrices
Let $A$ be a permutation matrix. $|\det(A)|$ will always be 1; this is obviously "morally" correct since the map they represent won't distort volume, but for a more rigorous proof, do induction. It's true for 1x1 and 2x2 permutation matrices, and for the induction step, expand by minors; only 1 entry on the top row will be a 1, and the corresponding minor will be another permutation matrix, so the determinant of the whole is 1. 

We can get a stronger result: $\det(A)$ gives the sign of $A$. After all, each transposition corresponds to swapping two columns, which changes the sign of the determinant, so even/odd number of transpositions = even/odd number of sign changes = determinant 1 or -1. 